{% extends "base.html" %}

{% from '_componentes_paciente.html' import render_campo, render_campo_textarea %}

{% block title %}Editar Paciente - {{ paciente.nombres }} {{ paciente.apellidos }}{% endblock %}

{% block head_extra %}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="edit-header text-center mb-4">
        <h1>Editando Perfil</h1>
        <p>Paciente: <strong>{{ paciente.nombres }} {{ paciente.apellidos }}</strong> (ID: {{ paciente.id }})</p>
    </div>

    <form action="{{ url_for('pacientes.editar_paciente', id=paciente.id) }}" method="POST" enctype="multipart/form-data">
        
        <!-- ============================================== -->
        <!-- DATOS PERSONALES (NO PLEGABLE, PERO CON ESTILO DE TARJETA) -->
        <!-- ============================================== -->
        <fieldset class="border p-3">
            <legend class="w-auto px-2 d-flex align-items-center">
                <i data-lucide="user-circle" class="accordion-icon"></i> 
                Datos Personales
            </legend>
            <div class="p-3">
                <div class="row mb-3">
                    {{ render_campo('Nombres', 'nombres', paciente) }}
                    {{ render_campo('Apellidos', 'apellidos', paciente) }}
                    <div class="col-md-3">
                        <label for="tipo_documento" class="form-label">Tipo de Documento</label>
                        <select class="form-select" id="tipo_documento" name="tipo_documento">
                            <option value="CC" {% if paciente.tipo_documento == 'CC' %}selected{% endif %}>Cédula</option>
                            <option value="TI" {% if paciente.tipo_documento == 'TI' %}selected{% endif %}>T. Identidad</option>
                            <option value="RC" {% if paciente.tipo_documento == 'RC' %}selected{% endif %}>Registro Civil</option>
                            <option value="CE" {% if paciente.tipo_documento == 'CE' %}selected{% endif %}>Cédula Extranjería</option>
                            <option value="PA" {% if paciente.tipo_documento == 'PA' %}selected{% endif %}>Pasaporte</option>
                            <option value="PPT" {% if paciente.tipo_documento == 'PPT' %}selected{% endif %}>Permiso Protección</option>
                        </select>
                    </div>
                    {{ render_campo('Documento', 'documento', paciente) }}
                </div>
                <div class="row mb-3">
                    {{ render_campo('Fecha de Nacimiento', 'fecha_nacimiento', paciente, type='date') }}
                    {{ render_campo('Edad', 'edad', paciente, type='number') }}
                    {{ render_campo('Email', 'email', paciente, type='email') }}
                    {{ render_campo('Teléfono', 'telefono', paciente) }}
                </div>
                 <div class="row mb-3">
                    <div class="col-md-3">
                        <label for="genero" class="form-label">Género</label>
                        <select class="form-select" id="genero" name="genero">
                            <option value="Masculino" {% if paciente.genero == 'Masculino' %}selected{% endif %}>Masculino</option>
                            <option value="Femenino" {% if paciente.genero == 'Femenino' %}selected{% endif %}>Femenino</option>
                            <option value="Otro" {% if paciente.genero == 'Otro' %}selected{% endif %}>Otro</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="estado_civil" class="form-label">Estado Civil</label>
                        <select class="form-select" id="estado_civil" name="estado_civil">
                             <option value="Soltero/a" {% if paciente.estado_civil == 'Soltero/a' %}selected{% endif %}>Soltero/a</option>
                             <option value="Casado/a" {% if paciente.estado_civil == 'Casado/a' %}selected{% endif %}>Casado/a</option>
                             <option value="Unión Libre" {% if paciente.estado_civil == 'Unión Libre' %}selected{% endif %}>Unión Libre</option>
                             <option value="Separado/a" {% if paciente.estado_civil == 'Separado/a' %}selected{% endif %}>Separado/a</option>
                             <option value="Viudo/a" {% if paciente.estado_civil == 'Viudo/a' %}selected{% endif %}>Viudo/a</option>
                        </select>
                    </div>
                </div>
            </div>
        </fieldset>

        <!-- ============================================== -->
        <!-- ACORDEÓN REUTILIZADO PARA EL RESTO DE SECCIONES -->
        <!-- ============================================== -->
        {% include '_accordion_registro_paciente.html' with context %}
        
        <!-- ============================================== -->
        <!-- BOTONES FINALES -->
        <!-- ============================================== -->
        <div class="mt-5 mb-5 d-flex gap-3 justify-content-center">
            <button type="submit" class="btn btn-dark">Guardar Cambios</button>
            <a href="{{ url_for('pacientes.mostrar_paciente', id=paciente.id) }}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>
{% endblock %}


{% block scripts %}

{% endblock %}